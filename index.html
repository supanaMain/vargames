<!DOCTYPE html>
<html lang="ja">

<head>
 <meta charset="utf-8">
 <meta http-equiv="X-UA-Compatible" content="IE=edge">
 <meta name="viewport" content="width=device-width, user-scalable=no">
 <meta name="mobile-web-app-capable" content="yes">
 <title>げぇむどす( 'ω')</title>
 <!-- Bootstrap -->
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
 <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.1.1/howler.min.js"></script>
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
 <style>
  test-text2 {
   padding: 0px;
   color: lime;
   font-family: Georgia;
   font-size: 100%;
   text-align: center;
  }

  test-text3 {
   padding: 0px;
   color: white;
  }

  test-text4 {
   padding: 0px;
   color: gray;
  }

  body {
   -webkit-text-size-adjust: 100%;
   padding: 30px;
   background-color: #222222;
  }

  rpg-player_status {
   color: white;
  }

  #menu-status-button {
   background-image: url('https://cdn.discordapp.com/attachments/706660445519347763/708180256972079104/336.png');
  }

  #menu-status-button:active {
   background-image: url('https://cdn.discordapp.com/attachments/706660445519347763/708180257173405696/336-1.png');
  }

  #playerhealthbar::-webkit-progress-bar {
   background: none;
  }

  #playerhealthbar::-webkit-progress-value {
   background-color: #32cd32;
  }

  #playerhealthbar_back::-webkit-progress-bar {
   background-color: black;
  }

  .playerhealthbar_back_p::-webkit-progress-value {
   background-color: #90ff7f;
  }

  .playerhealthbar_back_m::-webkit-progress-value {
   background-color: #2f4f4f;
  }

  #playertpbar::-webkit-progress-bar {
   background: none;
  }

  #playertpbar::-webkit-progress-value {
   background-color: #efc400;
  }

  #playertpbar_back::-webkit-progress-bar {
   background-color: black;
  }

  .playertpbar_back_p::-webkit-progress-value {
   background-color: #ffff4b;
  }

  .playertpbar_back_m::-webkit-progress-value {
   background-color: #4e3800;
  }


  #enemyhealthbar::-webkit-progress-bar {
   background: none;
  }

  #enemyhealthbar::-webkit-progress-value {
   background-color: #ff2658;
  }

  #enemyhealthbar_back::-webkit-progress-bar {
   background-color: black;
  }

  .enemyhealthbar_back_p::-webkit-progress-value {
   background-color: #ff8c00;
  }

  .enemyhealthbar_back_m::-webkit-progress-value {
   background-color: #af0000;
  }
 </style>
 <script>
  function sleep(time, data) {
   setTimeout(() => {
    if (data) data(time);
   }, time * 1000);
  }

  const now_version = "1.0.1";

  let player_battle = false;

  function rpg_player_status_set() {
   var player_status = JSON.parse(localStorage.getItem('player_status_key'));

   if (!player_status) {
    player_status_result = JSON.stringify({
     version: now_version,
     name: player_name,
     level: 1,
     exp: 0,
     nextexp: 20,
     hp: 20,
     maxhp: 20,
     tp: 100,
     maxtp: 100,
     atk: 1,
     def: 0,
     coin: 100,
     weapon: {
      id: ``,
      name: ``,
      atk: 0
     },
     items: [],
     skills: []
    });

    localStorage.setItem('player_status_key', player_status_result);
   } else {

    //アプデで追加した要素を埋め込む用

    if (player_status.tp == undefined) player_status.tp = 100;
    if (player_status.maxtp == undefined) player_status.maxtp = 100;
    if (player_status.weapon == undefined) player_status.weapon = { id: ``, name: ``, atk: 0 };
    if (player_status.items == undefined) player_status.items = [];
    if (player_status.skills == undefined) player_status.skills = [];

    var player_status_result = JSON.stringify(player_status);
    localStorage.setItem('player_status_key', player_status_result);
   }

   //初期技追加
   if (!player_status.skills.length) {
    var player_status = JSON.parse(localStorage.getItem('player_status_key'));
    var skill_data = JSON.stringify({
     id: "fullpower_attack",
     name: "ぜんりょくこうげき",
     type: "attack",
     atk: 2.5,
     tp: 25,
     all: false
    });
    player_status.skills.push(JSON.parse(skill_data));
    var player_status_result = JSON.stringify(player_status);
    localStorage.setItem('player_status_key', player_status_result);
   }


   var rpg_player_status_view = (`
             《おなまえ》${player_status.name} <br>
             ・レベル: ${player_status.level}<br>
             ・けいけんち: ${player_status.exp}<br>
                  - - -  つぎのレベルまで: ${player_status.nextexp}<br>   	
             ・たいりょく: ${player_status.hp} / ${player_status.maxhp}<br>
             ・こうげきりょく: ${player_status.atk}<br>
             ・ぼうぎょりょく: ${player_status.def}<br>
             ・TP : ${player_status.tp}% / ${player_status.maxtp}%<br>
             ・しょじきん: ${player_status.coin}
             <br>
        `)
   document.getElementById("rpg-player_status1").innerHTML = rpg_player_status_view;
   //       document.getElementById("rpg-player_status2").innerHTML = `<strong>《おなまえ》</strong>${player_status.name}<br>${rpg_player_status_view}`;
  }

  function rpg_player_status_set_view() {
   var player_status = JSON.parse(localStorage.getItem('player_status_key'));

   var rpg_player_status_view = (`
             《おなまえ》${player_status.name} <br>
             ・レベル: ${player_status.level}<br>
             ・けいけんち: ${player_status.exp}<br>
                  - - -  つぎのレベルまで: ${player_status.nextexp}<br>   	
             ・たいりょく: ${player_status.hp} / ${player_status.maxhp}<br>
             ・こうげきりょく: ${player_status.atk}<br>
             ・ぼうぎょりょく: ${player_status.def}<br>
             ・TP : ${player_status.tp}% / ${player_status.maxtp}%<br>
             ・しょじきん: ${player_status.coin}
             <br>
        `)
   document.getElementById("rpg-player_status1").innerHTML = rpg_player_status_view;
  }

  function status_edit_out() {
   document.getElementById("status_edit").style.display = "none";
  }
  //アイコンの指定
  function status_icon_set() {
   // フォームで選択された全ファイルを取得
   var fileList = document.getElementById("player_icon_target").files;

   // 個数分の画像を表示する
   for (var i = 0, l = fileList.length; l > i; i++) {
    // FileReaderオブジェクトを作成
    var fileReader = new FileReader();

    // 読み込み後の処理を決めておく
    fileReader.onload = function() {
     // Data URIを取得
     var dataUri = this.result;
     localStorage.setItem('player_icon_uri_key', dataUri);

     // HTMLに書き出し (src属性にData URIを指定)
     document.getElementById("player_icon").src = dataUri;
    }

    // ファイルをData URIとして読み込む
    fileReader.readAsDataURL(fileList[i]);
   }
   alert("アイコンを設定しました( 'ω')");

  }

  //バージョンが違う場合ステータスを初期化するコード(多分初期しか使わない)
  var player_status = JSON.parse(localStorage.getItem('player_status_key'));
  if (player_status && player_status.version != now_version) {
   localStorage.removeItem('player_status_key');
   alert("バージョンが更新されたため ステータスを初期化しました。\nページを再読み込みしてください。");
   rpg_player_status_set();
  }

  //サウンド

  var testsound = new Howl({ src: ['https://cdn.discordapp.com/attachments/709110499429711952/709276397386072164/click2.wav'] });

  function sound_testsound() {
   testsound.play();
  }
  var clicksound = new Howl({ src: ['https://cdn.discordapp.com/attachments/709110499429711952/709276397386072164/click2.wav'] });

  function sound_clicksound() {
   clicksound.play();
  }
  var clicknone = new Howl({ src: ['https://cdn.discordapp.com/attachments/709110499429711952/709410913643397140/none.wav'] });

  function sound_clicknone() {
   clicknone.play();
  }

  var damagesound = new Howl({ src: ['https://cdn.discordapp.com/attachments/709110499429711952/709276714102161479/damage.wav'] });

  function sound_damagesound() {
   damagesound.play();
  }

  var healsound = new Howl({ src: ['https://cdn.discordapp.com/attachments/709110499429711952/709276966838337586/heal.wav'] });

  function sound_damagesound() {
   healsound.play();
  }

  var encountsound = new Howl({ src: ['https://cdn.discordapp.com/attachments/709110499429711952/709310447743926322/ennkaunnto.wav'] });

  function sound_encountsound() {
   encountsound.play();
  }

  var deathsound = new Howl({ src: ['https://cdn.discordapp.com/attachments/709110499429711952/709310915723657247/b1959fa79da07675.wav'] });

  function sound_deathsound() {
   deathsound.play();
  }

  var guardsound = new Howl({ src: ['https://cdn.discordapp.com/attachments/709110499429711952/709311641333792788/112e08bc49ece07c.wav'] });

  function sound_guardsound() {
   guardsound.play();
  }

  var kaisinsound_1 = new Howl({ src: ['https://cdn.discordapp.com/attachments/709110499429711952/709314758838452255/kaisinn1.wav'] });

  function sound_kaisinsound_1() {
   kaisinsound_1.play();
  }
  var kaisinsound_2 = new Howl({ src: ['https://cdn.discordapp.com/attachments/709110499429711952/709314847879463015/kaisinn2.wav'] });

  function sound_kaisinsound_2() {
   kaisinsound_2.play();
  }

  var shoukansound = new Howl({ src: ['https://cdn.discordapp.com/attachments/709110499429711952/709314944314900510/shoukann.wav'] });

  function sound_shoukansound() {
   shoukansound.play();
  }

  var skillsound = new Howl({ src: ['https://cdn.discordapp.com/attachments/709110499429711952/709425255474528366/28c5c99a3314650c.wav'] });

  function sound_skillsound() {
   skillsound.play();
  }

  var escapesound = new Howl({ src: ['https://cdn.discordapp.com/attachments/709110499429711952/709661435499773952/escape.wav'] });

  function sound_escapesound() {
   escapesound.play();
  }





  //技追加テスト
  function test_skill_add() {
   var player_status = JSON.parse(localStorage.getItem('player_status_key'));
   var skill_data = JSON.stringify({
    id: "test",
    name: "てすとばすたー",
    type: "attack",
    atk: 2.5,
    tp: 5,
    all: true
   });
   player_status.skills.push(JSON.parse(skill_data));
   var player_status_result = JSON.stringify(player_status);
   localStorage.setItem('player_status_key', player_status_result);
  }

  function test_skill_remove() {
   var player_status = JSON.parse(localStorage.getItem('player_status_key'));
   player_status.skills.splice(player_status.skills.findIndex(data => data.id == "test"), 1);
   var player_status_result = JSON.stringify(player_status);
   localStorage.setItem('player_status_key', player_status_result);
  }

  function cralthclear_skill_add() {
   var player_status = JSON.parse(localStorage.getItem('player_status_key'));
   var skill_data = JSON.stringify({
    id: "cralthclear",
    name: "神葬 クラルスクリア",
    type: "attack",
    atk: 6.0,
    tp: 40,
    all: true
   });
   player_status.skills.push(JSON.parse(skill_data));
   var player_status_result = JSON.stringify(player_status);
   localStorage.setItem('player_status_key', player_status_result);
  }
 </script>
 <!-- <input id="testsound_button"type="submit" style="color:black; font-size:100%;" value="てすと" onClick="sound_testsound();"> -->
</head>

<body>
 <div id="start_window" style="height: 120%;width: 100%;">
  <input type="submit" class="btn btn-primary" style="width:70%;height:10%;position:relative; top:60px;left:12%;font-size:20px;text-align: center;" value="はじめる" onClick="sound_testsound();document.getElementById('start_window').style.display ='none';document.getElementById('main_windows').style.display ='block';document.getElementById('home').style.display ='block';"><br>
 </div>
 <div id="main_windows" style="display:none;">
  <!-- デバッグエリア -->
  <!--
	  <div style="position:relative;top:80px;left:100px;">
         <input type="submit"  value="わざついか" onClick="sound_testsound();test_skill_add();"><br><br>
         <input type="submit"  value="わざけし" onClick="sound_testsound();test_skill_remove();"><br>
	  </div>
	-->
  <div align="left" style="display:none;z-index: 600;position: fixed;top: 0;left: 0;height: 120%;width: 100%;background-size: 400px 400px;background-position: 0% 0px;background-image:url('https://cdn.discordapp.com/attachments/706660445519347763/708633819103756308/333-3.png');" id="status_edit">
   <input align="left" type="submit" style="color:black; width:8;font-size:100%;" value="閉じる" onClick="sound_clicksound();status_edit_out();">
   <br><strong style="text-align: left; color:white; position:relative; top: 50px; left:50px;">《おなまえ》</strong>
   <div style="text-align: left; width:80%; position:relative; top: 50px; left:50px;"><input type="text" style="color:black;" placeholder="おなまえを入力してください" id="player_name_txt" value="ななし"> <input type="submit" style="color:black; width:8;font-size:90%;" value="けってい！" onClick="sound_clicksound();name_check();"></div><br><br><br><br>
   <div style="position: relative;top: 0;left: 50px;">
    <input type="submit" style="color:black; width:8;font-size:90%;" value="けってい！" onClick="sound_clicksound();status_icon_set();"><br>
    <input type="file" id="player_icon_target">
   </div>
   <img id="player_icon_preview" src="https://cdn.discordapp.com/attachments/656126030062419998/704208453052137512/315.png" style="position: relative;bottom: 70px;right: 30px;width:70px;height:70px;" align="right"><br><br><br>
   <div style="position:relative; bottom: 100px;">
    <br><strong style="text-align: left; color:white; position:relative; top: 50px; left:50px;">《戦闘BGM》</strong>
    <!-- <input type="file" id="battle_bgm_target" > -->
    <div style="text-align: left; width:80%; position:relative; top: 50px; left:50px;">
     <input type="url" style="color:black;" placeholder="戦闘曲のURL" id="battle_music_txt" value="">
     <input type="submit" style="color:black; width:8;font-size:90%;" value="けってい！" onClick="sound_clicksound();battlemusic_check();">
    </div>
   </div><br><br><br>
   <script>
    document.getElementById("player_icon_target").addEventListener("change", function() {
     var fileList = this.files;
     for (var i = 0, l = fileList.length; l > i; i++) {
      var fileReader = new FileReader();
      fileReader.onload = function() {
       var dataUri = this.result;
       document.getElementById("player_icon_preview").src = dataUri;
      }
      fileReader.readAsDataURL(fileList[i]);
     }
    });

    //戦闘BGM
    var battlemusic_url = localStorage.getItem('battle_music_url_key');
    if (!battlemusic_url) {
     battlemusic_url = "https://cdn.discordapp.com/attachments/709110499429711952/710014399384911992/bae5562308ab01d4.wav";
    } else {
     document.getElementById("battle_music_txt").value = battlemusic_url;
    }
    var battlemusic = new Howl(
    {
     src: [battlemusic_url],
     loop: true
    });
    /*
var battlemusic_url_kouho = ``;
document.getElementById( "battle_bgm_target" ).addEventListener( "change", function() {
	var fileList = this.files ;
	for( var i=0,l=fileList.length; l>i; i++ ) {
		var fileReader = new FileReader() ;
		fileReader.onload = function() {
			battlemusic_url_kouho = this.result ;
		}
		fileReader.readAsDataURL( fileList[i] ) ;
	}
} ) ;
*/
    function battlemusic_check() {
     var check = document.getElementById("battle_music_txt").value;
     battlemusic.src = [check];
     localStorage.setItem('battle_music_url_key', check);
     alert("BGMを設定しました( 'ω')");
    }

    function bgm_battlemusic() {
     battlemusic.play();
    }
   </script>
  </div>
  <div style="z-index: 499;position: fixed;top: 0;left: 0;height: 120%;width: 60px;background-size: 100% 100%;background-position: 0% 0px;background-image:url('https://cdn.discordapp.com/attachments/706660445519347763/708634331517681664/333-4.png');" id="menu_bar">
   <label id="menu-status-button" style="z-index: 500;position: relative;top: 1px;left: 1px;height: 54px;width: 54px;background-size: 100% 100%;background-position: 0% 0px;">
    <input type="button" id="menu-status-button-b" onClick="sound_clicksound();player_status_main_button();" style="display:none;">
   </label>
  </div>
  <div style="display:none;z-index: 100;position: fixed;top: 0;right: 0px;height: 310px;width: 300px;background-size: 100% 100%;background-position: 0% 0px;background-image:url('https://cdn.discordapp.com/attachments/706660445519347763/706851683602268201/331-2.png');" id="player_status_main">
   <rpg-player_status>
    <!-- <img style="position:relative; top: 400px; left:0%;" class="img-responsive center-block" src = "https://cdn.discordapp.com/attachments/706660445519347763/706660466859966570/331.png"> -->
    <img id="player_icon" src="https://cdn.discordapp.com/attachments/656126030062419998/704208453052137512/315.png" style="position:relative; top: 30px; left: 45px;width:54px;height:54px;">
    <script>
     var player_icon_uri = localStorage.getItem('player_icon_uri_key');
     if (player_icon_uri) {
      document.getElementById("player_icon").src = player_icon_uri;
      document.getElementById("player_icon_preview").src = player_icon_uri;
     }
    </script>
    <div style="position:relative; top: 40px; left:0px;">
     <p id="rpg-player_status1" style="font-size:14px;position:relative; top: 0px; left:10%;"></p>
    </div>
    <input type="button" style="position:relative; top: 0px; left: 210px;color:black; width:8;font-size:100%;" value="編集" onClick="sound_clicksound();document.getElementById('status_edit').style.display = 'block';">
   </rpg-player_status>
  </div>
  <home id="home" name="home" style="padding-left: 40px;">
   <p class="lead" style="color:white;" id="home_tag">げぇむ HOME </p>
   <script>
    document.getElementById("home_tag").innerHTML += `-- Ver ${now_version}`
   </script>
   <br><br>
   <input type="submit" style="color: white;" value="RPGもどきをやる(開発段階)" class="btn btn-primary" id="rpg-move-button" onClick="sound_clicksound();rpg_move_button();">
   <br><br>
   <input type="submit" style="color: white;" value="スロットをやる" class="btn btn-primary" id="slot-move-button" onClick="sound_clicksound();slot_move_button();">
   <br><br><br><br><br><br><br><br>
   <!-- <img class="img-responsive center-block" src = "https://cdn.discordapp.com/attachments/656126030062419998/704208453052137512/315.png"> -->
   <test class="btn btn-primary" id="delete-button">データを削除</test>
   <script>
    var player_name = localStorage.getItem('player_name_key');
    if (!player_name) player_name = `ななし`;
    player_name_txt.value = player_name;

    function name_check() {
     var player_name_txt = document.getElementById("player_name_txt").value;
     if (player_name_txt && player_name_txt.length <= 10) {
      player_name = player_name_txt;
      localStorage.setItem('player_name_key', player_name);
      var player_status = JSON.parse(localStorage.getItem('player_status_key'));
      if (player_status) {
       player_status.name = player_name;
       player_status = JSON.stringify(player_status);
       localStorage.setItem('player_status_key', player_status);
       rpg_player_status_set_view();
      }
      alert(`${player_name}にしました( 'ω')`);
     } else if (player_name_txt.length > 10) {
      alert("おなまえの長さは10文字までです( 'ω')");
      return;
     } else {
      alert("おなまえを入力してください( 'ω')");
      return;
     }
    }
    document.getElementById("delete-button").onclick = function() {
     var result = window.confirm('削除しますか？');
     if (result == true) {
      result = window.confirm('本当に削除しますか？');
      if (result == true) {
       result = window.confirm('消したデータは返ってきません。それでも削除しますか？');
       if (result == true) {
        result = window.confirm('本当に消したデータは返ってきません。それでも削除しますか？');
        if (result == true) {
         result = window.confirm('こうかいしませんね？');
         if (result == true) {
          var player_icon_uri = localStorage.getItem('player_icon_uri_key');
          var player_name = localStorage.getItem('player_name_key');

          localStorage.clear();
          if (player_icon_uri) localStorage.setItem('player_icon_uri_key', player_icon_uri);
          if (player_name) localStorage.setItem('player_name_key', player_name);

          alert('データを初期化しました。webを更新してください。');
          rpg_player_status_set();
         }
        }
       }
      }
     }
    }
   </script>
  </home>
  <slot id="slot-game" style="padding-left: 40px;">
   <p class="lead" style="color:white;">すろっと</p>
   <br>
   <input type="submit" value="ホームに戻る" class="btn btn-primary" id="home-move-button" onClick="sound_clicksound();home_move_button();">
   <test class="btn btn-primary" id="logclear-button">ログをクリア</test>
   <br><br><br>
   <test class="btn btn-primary" id="test-button">スロットをまわす</test>
   <div style="border: groove white; width: 160px; position:relative; top: -32px; left: 55%;">
    <p id="slot-shojikin" style="color: white; position:relative; top: 5px; left:8%;"></p>
   </div>
   <br>
   <slot-pname>
    <h4 id="slot-pname" style="color:white;">- - - - -</h4>
   </slot-pname>
   <test-text2>
    <h1 id="test-button-text2" style="border: groove gray;">- - - - -</h1>
   </test-text2>
   <test-text3>
    <h3 id="test-button-text3"></h3>
   </test-text3>
   <br>
   <test-text4>
    <p id="test-button-text4" style="border: groove white"></p>
   </test-text4>
   <script>
    var day = ``;
    setInterval(() => {
     day = new Date().toLocaleString({ timeZone: 'Asia/Tokyo' });
    }, 1000);
    var player_status = JSON.parse(localStorage.getItem('player_status_key'));
    if (player_status) document.getElementById("slot-shojikin").innerHTML = `しょじきん: ${player_status.coin} ｺｲﾝ`;
    var slot_1 = ``;
    var slot_2 = ``;
    var slot_3 = ``;
    var result_txt = ``;
    var result = ``;
    var result_log = ``;
    var slot_get_coin = 0;
    document.getElementById("test-button").onclick = function() {
     //            alert("クリックしました( 'ω')");
     result_log = `${result} ${result_txt}<br>${result_log}`;
     document.getElementById("test-button-text4").innerHTML = result_log;
     slot_1 = Math.floor(Math.random() * 9) + 1;
     slot_2 = Math.floor(Math.random() * 9) + 1;
     slot_3 = Math.floor(Math.random() * 9) + 1;
     if (slot_1 == slot_2 && slot_1 == slot_3 && slot_1 == 7) {
      slot_get_coin = 777;
      result_txt = `ラッキーセブン！ ${Math.abs(slot_get_coin)} コイン 獲得した！`;
     } else if (slot_1 == slot_2 && slot_1 == slot_3 && slot_1 == 6) {
      slot_get_coin = -666;
      result_txt = `数字が不吉なのでおおはずれ！${Math.abs(slot_get_coin)} コイン 失った！`;
     } else if (slot_1 == 3 && slot_2 == 3 && slot_3 == 4) {
      slot_get_coin = -100;
      result_txt = `なんでや！阪神関係無いやろ！${Math.abs(slot_get_coin)} コイン 失った！ `;
     } else if (slot_1 == slot_2 && slot_1 == slot_3) {
      slot_get_coin = (150 + Math.floor(Math.random() * 101));
      result_txt = `おめでとう！ ${Math.abs(slot_get_coin)} コイン 獲得した！`;
     } else if (slot_1 == 3 && slot_2 == 1 && slot_3 == 4) {
      slot_get_coin = (50 + Math.floor(Math.random() * 101));
      result_txt = `円周率かな？( \'ω\') ${Math.abs(slot_get_coin)} コイン 獲得した！`;
     } else if ((slot_1 == 5 && slot_2 == 1 && slot_3 == 4) || (slot_1 == 1 && slot_2 == 1 && slot_3 == 4) || (slot_1 == 9 && slot_2 == 3 && slot_3 == 1)) {
      slot_get_coin = (-50 - Math.floor(Math.random() * 101));
      result_txt = `ざんねん！ 数字がきたないで賞！${Math.abs(slot_get_coin)} コイン 失った！ `;
     } else if (slot_1 == slot_2 || slot_2 == slot_3 || slot_1 == slot_3) {
      slot_get_coin = 0;
      result_txt = `おしい！コインは失わなかった！ `;
     } else {
      slot_get_coin = (-1 - Math.floor(Math.random() * 4));
      result_txt = `ざんねん！ ${Math.abs(slot_get_coin)} コイン 失った！`;
     }
     result_txt = `${result_txt} -- ${day}`;
     player_status = JSON.parse(localStorage.getItem('player_status_key'));
     if (player_status) {
      player_status.coin = player_status.coin * 1 + slot_get_coin * 1;
      player_status.coin = player_status.coin * 1 < 0 ? 0 : player_status.coin;
      document.getElementById("slot-shojikin").innerHTML = `しょじきん: ${player_status.coin} ｺｲﾝ`;
      player_status = JSON.stringify(player_status);
      localStorage.setItem('player_status_key', player_status);
      rpg_player_status_set_view();
     }
     result = `| ${slot_1} : ${slot_2} : ${slot_3} |`;
     document.getElementById("slot-pname").innerHTML = `${player_name}の結果は...`;
     document.getElementById("test-button-text2").innerHTML = result;
     document.getElementById("test-button-text3").innerHTML = result_txt;
    };

    document.getElementById("logclear-button").onclick = function() {
     var logclear = window.confirm('ログを削除しますか？');
     if (logclear == true) document.getElementById("test-button-text4").innerHTML = ``;
    }
   </script>
  </slot>
  <rpg id="rpg-game" style="padding-left: 40px;position:static;">
   <div id="rpg_header">
    <p class="lead" style="color:white;">RPGもどき</p> <input type="submit" value="ホームに戻る" class="btn btn-primary" id="rpg_home_move_button" onClick="sound_clicksound();home_move_button();">
    <br><br><br>
    <input align="left" type="submit" style="color:black; width:8;font-size:100%;" value="ショップ(即席)" onClick="sound_clicksound();document.getElementById('shop').style.display = 'block';"><br><br><br>
    <div align="left" style="display:none;z-index: 600;position: fixed;top: 0;left: 0;height: 120%;width: 100%;background-size: 400px 400px;background-position: 0% 0px;background-image:url('https://cdn.discordapp.com/attachments/706660445519347763/708633819103756308/333-3.png');" id="shop">
     <input align="left" type="submit" style="color:black; width:8;font-size:100%;" value="閉じる" onClick="sound_clicksound();document.getElementById('shop').style.display = 'none';"><br><br><br>
     <div style="padding-left: 60px;">
      <input align="left" type="submit" style="color:black; width:8;font-size:100%;" id="yakuso_shop" value="やくそう  $40ｺｲﾝ" onClick="sound_clicksound();yakuso_shop();"><br><br>
      <input align="left" type="submit" style="color:black; width:8;font-size:100%;" id="yakuso_2_shop" value="つよいやくそう  $120ｺｲﾝ" onClick="sound_clicksound();yakuso_2_shop();"><br><br>
      <input align="left" type="submit" style="color:black; width:8;font-size:100%;" id="heal_kusuri_shop" value="回復薬  $250ｺｲﾝ" onClick="sound_clicksound();heal_kusuri_shop();"><br><br>
      <input align="left" type="submit" style="color:black; width:8;font-size:100%;" id="heal_kusuri_2_shop" value="つよい回復薬    $550ｺｲﾝ" onClick="sound_clicksound();heal_kusuri_2_shop();"><br><br>
      <input align="left" type="submit" style="color:black; width:8;font-size:100%;" id="heal_kusuri_3_shop" value="超回復薬    $1100ｺｲﾝ" onClick="sound_clicksound();heal_kusuri_3_shop();"><br><br>
      <br>
      <input align="left" type="submit" style="color:black; width:8;font-size:100%;" id="skill_toriaezunaguru_shop" value="ぜんいんなぐる の秘伝書  1200ｺｲﾝ" onClick="sound_clicksound();skill_toriaezunaguru_shop();"><br><br>
     </div>
     <script>
      var player_status = JSON.parse(localStorage.getItem('player_status_key'));

      function shop_view_set() {
       if (player_status.skills.findIndex(data => data.id == "skill_toriaezunaguru") != -1) document.getElementById('skill_toriaezunaguru_shop').style.display = 'none';
      }
      shop_view_set();

      function yakuso_shop() {
       var nedan = 40;
       var result = window.confirm('やくそう を購入しますか？');
       if (result == true && (player_status.coin * 1) >= nedan) {
        let if_item_data = player_status.items.find(data => data.id == 'yakuso');
        let item_data_index = player_status.items.findIndex(data => data.id == 'yakuso');
        if (if_item_data) {
         var item_number = player_status.items[item_data_index].number * 1 + 1;
         if (item_number <= 99) {
          player_status.items[item_data_index].number = item_number;
         } else {
          alert("やくそう はこれ以上持ちきれません");
          return;
         }
        } else {
         var item_data = JSON.stringify({
          id: "yakuso",
          name: "やくそう",
          number: 1,
          type: "heal",
          value: 30.0,
          cost: true,
          all: false
         });
         player_status.items.push(JSON.parse(item_data));
        }
        player_status.coin = player_status.coin * 1 - nedan;
        var player_status_result = JSON.stringify(player_status);
        localStorage.setItem('player_status_key', player_status_result);
        rpg_player_status_set_view();
        shop_view_set();

        alert('やくそう を購入した！');
        return;
       } else if (result == true) {
        alert("コインが足りません( 'ω')");
        return;
       }
      }

      function yakuso_2_shop() {
       var nedan = 120;
       var result = window.confirm('やくそう を購入しますか？');
       if (result == true && (player_status.coin * 1) >= nedan) {
        let if_item_data = player_status.items.find(data => data.id == 'yakuso_2');
        let item_data_index = player_status.items.findIndex(data => data.id == 'yakuso_2');
        if (if_item_data) {
         var item_number = player_status.items[item_data_index].number * 1 + 1;
         if (item_number <= 99) {
          player_status.items[item_data_index].number = item_number;
         } else {
          alert("つよいやくそう はこれ以上持ちきれません");
          return;
         }
        } else {
         var item_data = JSON.stringify({
          id: "yakuso_2",
          name: "つよいやくそう",
          number: 1,
          type: "heal",
          value: 100.0,
          cost: true,
          all: false
         });
         player_status.items.push(JSON.parse(item_data));
        }
        player_status.coin = player_status.coin * 1 - nedan;
        var player_status_result = JSON.stringify(player_status);
        localStorage.setItem('player_status_key', player_status_result);
        rpg_player_status_set_view();
        shop_view_set();

        alert('つよいやくそう を購入した！');
        return;
       } else if (result == true) {
        alert("コインが足りません( 'ω')");
        return;
       }
      }

      function heal_kusuri_shop() {
       var nedan = 250;
       var result = window.confirm('回復薬 を購入しますか？');
       if (result == true && (player_status.coin * 1) >= nedan) {
        let if_item_data = player_status.items.find(data => data.id == 'heal_kusuri');
        let item_data_index = player_status.items.findIndex(data => data.id == 'heal_kusuri');
        if (if_item_data) {
         var item_number = player_status.items[item_data_index].number * 1 + 1;
         if (item_number <= 99) {
          player_status.items[item_data_index].number = item_number;
         } else {
          alert("回復薬 はこれ以上持ちきれません");
          return;
         }
        } else {
         var item_data = JSON.stringify({
          id: "heal_kusuri",
          name: "回復薬",
          number: 1,
          type: "heal",
          value: 250.0,
          cost: true,
          all: false
         });
         player_status.items.push(JSON.parse(item_data));
        }
        player_status.coin = player_status.coin * 1 - nedan;
        var player_status_result = JSON.stringify(player_status);
        localStorage.setItem('player_status_key', player_status_result);
        rpg_player_status_set_view();
        shop_view_set();

        alert('回復薬 を購入した！');
        return;
       } else if (result == true) {
        alert("コインが足りません( 'ω')");
        return;
       }
      }

      function heal_kusuri_2_shop() {
       var nedan = 550;
       var result = window.confirm('つよい回復薬 を購入しますか？');
       if (result == true && (player_status.coin * 1) >= nedan) {
        let if_item_data = player_status.items.find(data => data.id == 'heal_kusuri_2');
        let item_data_index = player_status.items.findIndex(data => data.id == 'heal_kusuri_2');
        if (if_item_data) {
         var item_number = player_status.items[item_data_index].number * 1 + 1;
         if (item_number <= 99) {
          player_status.items[item_data_index].number = item_number;
         } else {
          alert("つよい回復薬 はこれ以上持ちきれません");
          return;
         }
        } else {
         var item_data = JSON.stringify({
          id: "heal_kusuri_2",
          name: "つよい回復薬",
          number: 1,
          type: "heal",
          value: 500.0,
          cost: true,
          all: false
         });
         player_status.items.push(JSON.parse(item_data));
        }
        player_status.coin = player_status.coin * 1 - nedan;
        var player_status_result = JSON.stringify(player_status);
        localStorage.setItem('player_status_key', player_status_result);
        rpg_player_status_set_view();
        shop_view_set();

        alert('つよい回復薬 を購入した！');
        return;
       } else if (result == true) {
        alert("コインが足りません( 'ω')");
        return;
       }
      }

      function heal_kusuri_3_shop() {
       var nedan = 1100;
       var result = window.confirm('超回復薬 を購入しますか？');
       if (result == true && (player_status.coin * 1) >= nedan) {
        let if_item_data = player_status.items.find(data => data.id == 'heal_kusuri_3');
        let item_data_index = player_status.items.findIndex(data => data.id == 'heal_kusuri_3');
        if (if_item_data) {
         var item_number = player_status.items[item_data_index].number * 1 + 1;
         if (item_number <= 99) {
          player_status.items[item_data_index].number = item_number;
         } else {
          alert("超回復薬 はこれ以上持ちきれません");
          return;
         }
        } else {
         var item_data = JSON.stringify({
          id: "heal_kusuri_3",
          name: "超回復薬",
          number: 1,
          type: "heal",
          value: 1000,
          cost: true,
          all: false
         });
         player_status.items.push(JSON.parse(item_data));
        }
        player_status.coin = player_status.coin * 1 - nedan;
        var player_status_result = JSON.stringify(player_status);
        localStorage.setItem('player_status_key', player_status_result);
        rpg_player_status_set_view();
        shop_view_set();

        alert('超回復薬 を購入した！');
        return;
       } else if (result == true) {
        alert("コインが足りません( 'ω')");
        return;
       }
      }


      function skill_toriaezunaguru_shop() {
       var nedan = 1200;
       var result = window.confirm('ぜんいんなぐるの秘伝書 を購入しますか？');
       if (result == true && (player_status.coin * 1) >= nedan) {
        player_status.coin = player_status.coin * 1 - nedan;
        var skill_data = JSON.stringify({
         id: "skill_toriaezunaguru",
         name: "ぜんいんなぐる",
         type: "attack",
         atk: 2.0,
         tp: 30,
         all: true
        });
        player_status.skills.push(JSON.parse(skill_data));
        var player_status_result = JSON.stringify(player_status);
        localStorage.setItem('player_status_key', player_status_result);
        rpg_player_status_set_view();
        shop_view_set();

        alert('わざ  ぜんいんなぐる  をおぼえた！');
        return;
       } else if (result == true) {
        alert("コインが足りません( 'ω')");
        return;
       }
      }
     </script>
    </div>
   </div>
   <!-- 敵召喚デバッグ -->
   <div id="battle_start_debug_button">
    <input type="submit" value="戦闘開始(てすてす)" id="testes-button" onClick="sound_clicksound();enemy_testes();"><br><br>
    <input type="submit" value="戦闘開始(てすてす x3)" id="testes-button" onClick="sound_clicksound();enemy_testes_2();"><br><br>
    <input type="submit" value="戦闘開始(てすてす キング)" id="testes-button" onClick="sound_clicksound();enemy_testes_3();"><br><br>
    <input type="submit" value="戦闘開始(メタルなんとかフェスティバル)" id="testes-button" onClick="sound_clicksound();enemy_metal_nan_0();"><br><br>
    <input type="submit" value="戦闘開始(メタルなんとかフェスティバル EX)" id="testes-button" onClick="sound_clicksound();enemy_metal_nan_1();"><br><br><br>
    <input type="submit" value="戦闘開始(クリル・クラルサー)" id="testes-button" onClick="sound_clicksound();enemy_cril();"><br><br>
    <!--     <input type="submit" value="戦闘開始(クリル・クラルサー テスト)"  id="testes-button" onClick="sound_clicksound();enemy_cril_2();"><br><br><br> -->
    <input type="submit" value="戦闘開始(テスト(音量注意))" id="testes-button" onClick="sound_clicksound();enemy_metal_mini();">
   </div>
   <div id="player_battle_window" style="display:none;bottom: 20px;">
    <!-- <div style="position:relative; top: -20px; left:0px;"><strong style="color:white">HP SET (デバッグ) - </strong><input type="text" id="hp" value="100"> <input type="submit" style="color: black;" value="SET" id="hp_button" onClick="return test_click();"></div> -->
    <div id="enemyhealthbar_core" style="position:fixed; top: 12px; right:20px;display:block;" align="right">
     <nobr>
      <a style="color:white;position:relative; top: 0px; left:303.5px;text-align:left;"><strong id="enemyhealth_value"></strong></a>
      <progress id="enemyhealthbar_back" max="100" value="0" align="left" style="width:300px;position:relative; top: 0px; left:303.5px;-webkit-appearance: none;appearance: none;" class=""></progress>
      <progress id="enemyhealthbar" max="100" value="0" align="left" style="width:300px;position:relative; top: 0px; left:0px;-webkit-appearance: none;appearance: none;"></progress>
      <br><a style="color:white;position:relative; top: 0px; left:0px;"><strong id="enemyhealth_name">エネミー</strong></a>
     </nobr>
    </div><br><br>
    <div id="playerhealthbar_core" style="position:fixed;top: 40px;left: 122px">
     <nobr>
      <progress id="playerhealthbar_back" max="100" value="0" style="position:relative; top: 0px; left:0px;-webkit-appearance: none;appearance: none;" class=""></progress>
      <progress id="playerhealthbar" max="100" value="0" style="position:relative; top: 0px; left:-143.5px;-webkit-appearance: none;appearance: none;"></progress>
      <a style="color:white;position:relative; top: 0px; left:-143.5px;text-align:left;"><strong id="playerhealth_value"></strong></a>
      <br><a style="color:white"><strong id="playerhealth_name"></strong></a>
     </nobr>
    </div><br>
    <div style="position: fixed;top: 0;left: 60px;height: 120%;width: 50px;background-size: 100% 100%;background-position: 0% 0px;background-image:url('https://cdn.discordapp.com/attachments/706660445519347763/709400542782292088/333-6.png');"></div>
    <div id="playertpbar_core" style="position:fixed;bottom: 50px;left: 68px;">
     <nobr>
      <br><a style="color:white;position:relative; bottom: 140px; left:18px;"><strong id="playertp_name">TP</strong></a>
      <div style="transform: rotate(-90deg);position:relative;right: 212px;bottom:173.5px;">
       <progress id="playertpbar_back" max="100" value="0" style="width:220px;position:relative; top: 0px; left:0px;-webkit-appearance: none;appearance: none;" class=""></progress>
       <progress id="playertpbar" max="100" value="0" style="width:220px;position:relative; top: 0px; left:-223.5px;-webkit-appearance: none;appearance: none;"></progress>
      </div>
      <a style="color:white;position:relative; bottom: 5px; left:19px;text-align:left;"><strong id="playertp_value"></strong></a>
     </nobr>
    </div><br>
    <div id="player_attack_enemy_select" style="overflow:auto;z-index: 200;display:none;position:fixed;bottom:30px;right:10px;width:260px;height:85%;border: groove white;background-color: #141c29;opacity:100%;">
     <div id="player_attack_enemy_select_2" style="position:relative;top: 12px;left:20px;">
     </div>
     <div style="font-size:12px;position:fixed;bottom:35px;right:20px;"><input type="submit" value="キャンセル" id="" onClick="sound_clicksound();document.getElementById('player_attack_enemy_select').style.display = 'none';document.getElementById('player_battle_commands2').style.display = 'block';"></div>
    </div>
    <div style="padding-left:50px;">
     <rpg-player_status>
      <div id="rpg-player_battlelog" style="overflow:auto;font-size:13px;display:block;position:fixed;height:80px;width:80%;bottom:70px;border: groove white;background-color: #141c29;"></div>
      <rpg-player_status>
       <!-- <rpg-player_status><p id="rpg-player_status2"style="border: groove white;"></p></rpg-player_status> -->
       <br>
       <div id="player_battle_commands2" style="display:block;position:fixed;bottom:30px;">
        <nobr>
         <input style="width:17%;" type="submit" value="こうげき" class="btn btn-primary" id="attack-button" onClick="sound_clicksound();player_skill_command_select_skill_index = -1;player_attack_command();">
         <input style="width:17%;" type="submit" value="わざ" class="btn btn-primary" id="skill-button" onClick="sound_clicksound();player_skill_command();">
         <input style="width:17%;" type="submit" value="ぼうぎょ" class="btn btn-primary" id="guard-button" onClick="sound_clicksound();player_guard_command();">
         <input style="width:17%;" type="submit" value="もちもの" class="btn btn-primary" id="item-button" onClick="sound_clicksound();player_item_command();">
         <input style="width:17%;" type="submit" value="ほうち" class="btn btn-primary" id="holding-button" onClick="sound_clicksound();player_holding_command();">
         <input style="width:17%;" type="submit" value="にげる" class="btn btn-primary" id="escape-button" onClick="sound_clicksound();player_escape_command();">
        </nobr>
       </div>
    </div>
   </div>
   <br><br>
   <!--
  <input type="submit" value="経験値 +10 (デバッグ)" class="btn btn-primary" id="home-move-button" onClick="return test_enemy_death1();">
 <br><br>
  <input type="submit" value="経験値 +100 (デバッグ)" class="btn btn-primary" id="home-move-button" onClick="return test_enemy_death2();">
 <br><br>
  <input type="submit" value="経験値 +1000 (デバッグ)" class="btn btn-primary" id="home-move-button" onClick="return test_enemy_death3();">
 <br><br>
  <input type="submit" value="経験値 +9999 (デバッグ)" class="btn btn-primary" id="home-move-button" onClick="return test_enemy_death4();">
 <br><br>
  <input type="submit" value="経験値 +Infinity (デバッグ)" class="btn btn-primary" id="home-move-button" onClick="return test_enemy_death5();">
-->
   <script>
    var new_battlelog = ``;
    setInterval(() => {
     if (document.getElementById("rpg-game").style.display == "block") {
      var battlelog = document.getElementById("rpg-player_battlelog").innerHTML;
      if (new_battlelog) {
       var battlelog_scroll = battlelog.split("<br>").length * 20;
       battlelog = (`${battlelog}<br>${new_battlelog}`).split("<br>").slice(-8).join("<br>");
       $("#rpg-player_battlelog").animate({
        scrollTop: battlelog_scroll
       });
      }
      document.getElementById("rpg-player_battlelog").innerHTML = battlelog;
      new_battlelog = ``;


      var orientation = window.orientation;
      if (orientation === 0) {
       document.getElementById("rpg_game_blocker").style.display = "block";
      } else {
       document.getElementById("rpg_game_blocker").style.display = "none";
      }

      if (player_battle == true) {
       document.getElementById("player_battle_window").style.display = "block";
       document.getElementById("rpg_header").style.display = "none";

       document.getElementById("battle_start_debug_button").style.display = "none";
      } else {
       document.getElementById("player_battle_window").style.display = "none";
       document.getElementById("rpg_header").style.display = "block";

       document.getElementById("battle_start_debug_button").style.display = "block";
      }

     }
    }, 20);

    //プレイヤーヘルス
    var health = 100;
    var player_status = JSON.parse(localStorage.getItem('player_status_key'));
    if (player_status) {
     document.getElementById("playerhealth_name").innerHTML = `${player_status.name} - `;
     health = (player_status.hp / player_status.maxhp) * 100;
    }
    var healthbarback = health;

    var progress_anim = 0;

    let playerhealthbar = document.getElementById("playerhealthbar");
    let playerhealthbar_back = document.getElementById("playerhealthbar_back");
    playerhealthbar.value = health;
    playerhealthbar_back.value = health;


    var tp = 100;
    var player_status = JSON.parse(localStorage.getItem('player_status_key'));
    if (player_status) {
     tp = (player_status.tp / player_status.maxtp) * 100;
    }
    var tpbarback = tp;

    var progress_anim_tp = 0;

    let playertpbar = document.getElementById("playertpbar");
    let playertpbar_back = document.getElementById("playertpbar_back");
    playertpbar.value = tp;
    playertpbar_back.value = tp;
    //エネミーヘルス
    var enemy_health = 100;
    var enemy_healthbarback = enemy_health;

    var progress_anim_2 = 0;

    let enemyhealthbar = document.getElementById("enemyhealthbar");
    let enemyhealthbar_back = document.getElementById("enemyhealthbar_back");
    enemyhealthbar.value = enemy_health;
    enemyhealthbar_back.value = enemy_health;

    let total_hp = 0;
    let total_maxhp = 0;

    setInterval(() => {
     //プレイヤー
     progress_anim = Math.abs(health - healthbarback) / 20.0;

     var player_status = JSON.parse(localStorage.getItem('player_status_key'));
     if (player_status) {
      document.getElementById("playerhealth_value").innerHTML = ` - ${player_status.hp} / ${player_status.maxhp}`;
      document.getElementById("playerhealth_name").innerHTML = ` - ${player_status.name} - `;
      health = (player_status.hp / player_status.maxhp) * 100;
     }
     if (health <= 0) {
      playerhealthbar.value = 0;
      playerhealthbar_back.value = 0;
     }
     if (health != healthbarback) {
      if (health > healthbarback) {
       healthbarback += progress_anim;
       playerhealthbar.value = healthbarback;
       playerhealthbar_back.value = health;

       playerhealthbar_back.classList.add("playerhealthbar_back_p");
       playerhealthbar_back.classList.remove("playerhealthbar_back_m");
      }
      if (health < healthbarback) {
       healthbarback -= progress_anim;
       playerhealthbar.value = health;
       playerhealthbar_back.value = healthbarback;

       playerhealthbar_back.classList.add("playerhealthbar_back_m");
       playerhealthbar_back.classList.remove("playerhealthbar_back_p");
      }
     }

     progress_anim_tp = Math.abs(tp - tpbarback) / 20.0;

     if (player_status) {
      document.getElementById("playertp_value").innerHTML = `${player_status.tp}<br>%`;
      tp = (player_status.tp / player_status.maxtp) * 100;
     }
     if (tp <= 0) {
      playertpbar.value = 0;
      playertpbar_back.value = 0;
     }
     if (tp != tpbarback) {
      if (tp > tpbarback) {
       tpbarback += progress_anim_tp;
       playertpbar.value = tpbarback;
       playertpbar_back.value = tp;

       playertpbar_back.classList.add("playertpbar_back_p");
       playertpbar_back.classList.remove("playertpbar_back_m");
      }
      if (tp < tpbarback) {
       tpbarback -= progress_anim_tp;
       playertpbar.value = tp;
       playertpbar_back.value = tpbarback;

       playertpbar_back.classList.add("playertpbar_back_m");
       playertpbar_back.classList.remove("playertpbar_back_p");
      }
     }
     //エネミー

     progress_anim_2 = Math.abs(enemy_health - enemy_healthbarback) / 20.0;
     var enemy_status = JSON.parse(localStorage.getItem('enemy_status_key'));
     if (enemy_status) {
      total_hp = 0;
      enemy_status.enemies.forEach(enemy => total_hp += enemy.hp);
      if (isNaN(total_hp)) total_hp = 0;
      document.getElementById("enemyhealth_value").innerHTML = `${total_hp} / ${total_maxhp} - `;
      var total_name = ``;
      enemy_status.enemies.forEach(enemy => total_name += `- ${enemy.name} -<br>`);
      document.getElementById("enemyhealth_name").innerHTML = total_name;

      enemy_health = (total_hp / total_maxhp) * 100;

     }
     if (enemy_health <= 0) {
      enemyhealthbar.value = 0;
      enemyhealthbar_back.value = 0;
     }
     if (enemy_health != enemy_healthbarback) {
      if (enemy_health > enemy_healthbarback) {
       enemy_healthbarback += progress_anim_2;
       if (enemy_health < enemy_healthbarback) enemy_healthbarback = enemy_health;
       enemyhealthbar.value = enemy_healthbarback;
       enemyhealthbar_back.value = enemy_health;

       enemyhealthbar_back.classList.add("enemyhealthbar_back_p");
       enemyhealthbar_back.classList.remove("enemyhealthbar_back_m");
      }
      if (enemy_health < enemy_healthbarback) {
       enemy_healthbarback -= progress_anim_2;
       if (enemy_health > enemy_healthbarback) enemy_healthbarback = enemy_health;
       enemyhealthbar.value = enemy_health;
       enemyhealthbar_back.value = enemy_healthbarback;

       enemyhealthbar_back.classList.add("enemyhealthbar_back_m");
       enemyhealthbar_back.classList.remove("enemyhealthbar_back_p");
      }
     }
    }, 20);

    function enemy_total_maxhp_set() {
     var enemy_status = JSON.parse(localStorage.getItem('enemy_status_key'));
     total_maxhp = 0;
     enemy_status.enemies.forEach(enemy => total_maxhp += enemy.maxhp);
     if (isNaN(total_maxhp)) total_maxhp = 1;
    }


    //デバッグ用
    function test_click() {
     var health_test_txt = document.getElementById("hp");
     health_test_txt.value = health_test_txt.value > 100 ? 100 : health_test_txt.value;


     var player_status = JSON.parse(localStorage.getItem('player_status_key'));
     player_status.hp = Math.round(player_status.maxhp * (health_test_txt.value / 100));
     health = (player_status.hp / player_status.maxhp) * 100;
     player_status = JSON.stringify(player_status);
     localStorage.setItem('player_status_key', player_status);
     rpg_player_status_set();
     progress_anim = Math.abs(health - healthbarback) / 50.0;

     enemy_health = health_test_txt.value;
     progress_anim_2 = Math.abs(enemy_health - enemy_healthbarback) / 50.0;
    }



    //levelupって書いてあるけど敵倒した処理(クソコード)
    function levelup() {
     var player_status = JSON.parse(localStorage.getItem('player_status_key'));
     var levelup_log = ``;
     if (player_status) {
      var enemy_exp = localStorage.getItem('enemy_exp');
      var enemy_coin = localStorage.getItem('enemy_coin');
      player_status.exp = player_status.exp * 1 + enemy_exp * 1;
      player_status.coin = player_status.coin * 1 + enemy_coin * 1;
      if (!(player_status.exp < player_status.nextexp || player_status.level >= 100)) {
       var now_lv = player_status.level * 1;
       var now_hp = player_status.maxhp * 1;
       var now_atk = player_status.atk * 1;
       var now_def = player_status.def * 1;
       while (player_status.exp >= player_status.nextexp && player_status.level < 100) {
        player_status.level = player_status.level * 1 + 1;
        player_status.maxhp = player_status.maxhp * 1 + 10;
        player_status.hp = player_status.maxhp;
        player_status.atk = player_status.atk * 1 + 3;
        player_status.def = player_status.def * 1 + 1;
        var nownextexp = player_status.nextexp;
        player_status.nextexp = Math.floor(nownextexp * 1 + (30 + (Math.floor(nownextexp * 0.12))));
       }
       var up_lv = player_status.level * 1;
       var up_hp = player_status.maxhp * 1;
       var up_atk = player_status.atk * 1;
       var up_def = player_status.def * 1;

       var now_2_lv = up_lv * 1 - now_lv * 1;
       var now_2_hp = up_hp * 1 - now_hp * 1;
       var now_2_atk = up_atk * 1 - now_atk * 1
       var now_2_def = up_def * 1 - now_def * 1;
       if (player_status.level >= 100) {
        player_status.exp = "-";
        player_status.nextexp = "-";
       }
       levelup_log = `${player_status.name} はレベルが上がった！<br> ・レベル: ${now_lv} + ${now_2_lv}<br>・たいりょく: ${now_hp} + ${now_2_hp}<br> ・こうげきりょく: ${now_atk} + ${now_2_atk}<br>・ぼうぎょりょく: ${now_def} + ${now_2_def}`;
      }
      player_status = JSON.stringify(player_status);
      localStorage.setItem('player_status_key', player_status);
      rpg_player_status_set();
     }
     document.getElementById("rpg-player_battlelog").innerHTML = `\nコイン ${enemy_coin} , けいけんち ${enemy_exp} かくとく！<br>${levelup_log}`;
     localStorage.removeItem('enemy_exp');
     localStorage.removeItem('enemy_coin');
    }
    //エネミー
    function battle_start() {
     sound_encountsound();
     enemy_total_maxhp_set();

     player_battle = true;
     enemy_healthbarback = 0;
     enemy_healthbar = 100;
     document.getElementById("player_battle_commands2").style.display = "none";
     var enemy_status = JSON.parse(localStorage.getItem('enemy_status_key'));
     var player_status = JSON.parse(localStorage.getItem('player_status_key'));

     document.getElementById("rpg-player_battlelog").innerHTML = ``;
     for (index in enemy_status.enemies) document.getElementById("rpg-player_battlelog").innerHTML += ` <strong>${enemy_status.enemies[index].name}</strong> - `;
     document.getElementById("rpg-player_battlelog").innerHTML += `  が現れた！ `;

     player_status.hp = player_status.maxhp;
     player_status.tp = 0;
     tpbarback = 0;
     tpbar = 0;
     player_status = JSON.stringify(player_status);
     localStorage.setItem('player_status_key', player_status);
     rpg_player_status_set();
     setTimeout(() => {
      battlemusic.play();
     }, 500);
     setTimeout(() => {
      document.getElementById("player_battle_commands2").style.display = "block";
     }, 1500);
    }

    function battle_end() {
     document.getElementById("player_battle_commands2").style.display = "none";
     setTimeout(() => {
      battlemusic.stop();
     }, 500);
     setTimeout(() => {
      battle_end_2();
     }, 2600);
    }

    function battle_end_2() {
     player_battle = false;
     localStorage.removeItem('enemy_status_key');
     var player_status = JSON.parse(localStorage.getItem('player_status_key'));
     if (player_status.hp <= 0) {
      player_status.hp = player_status.maxhp;
      var player_status_result = JSON.stringify(player_status);
      localStorage.setItem('player_status_key', player_status_result);
     }
     rpg_player_status_set();
    }

    let function_player_damage = (`
   progress_anim = Math.abs(health - healthbarback) / 50.0;
`);
    let function_enemy_damage = (`
   progress_anim_2 = Math.abs(enemy_health - enemy_healthbarback) / 50.0;
`);

    let function_player_death = (`
     if(player_status.hp <= 0){
     	new_battlelog = \`${player_status.name}はちからつきてしまった...\`;
     	battle_end();
         return;
      }
`);

    let player_attack_command_select_enemy_index = 0;
    let player_skill_command_select_skill_index = -1;
    let player_item_command_select_item_index = 0;
    //わざ
    function player_skill_command() {
     var enemy_status = JSON.parse(localStorage.getItem('enemy_status_key'));
     var player_status = JSON.parse(localStorage.getItem('player_status_key'));

     document.getElementById('player_battle_commands2').style.display = 'none';
     //わざの数だけボタンを生成
     document.getElementById('player_attack_enemy_select_2').innerHTML = "";
     for (index in player_status.skills) {
      var enemy_taishou = player_status.skills[index].all == true ? `敵全体` : `敵単体`;
      document.getElementById('player_attack_enemy_select_2').innerHTML += `<div style="height:40px;"><input type=\"submit\" value=\"${player_status.skills[index].name} - 消費TP ${player_status.skills[index].tp} - 対象 ${enemy_taishou}\"  id=\"skill_select_button_${index}\" class="btn btn-primary" style=\"opacity:100%;font-size:73%;height:30px;width:86%;\"onClick=\"player_skill_command_select_skill_index = ${index}\;player_skill_command_2()\;\"></div>`;
     }
     document.getElementById('player_attack_enemy_select').style.display = 'block';

    }

    function player_skill_command_2() {
     var player_status = JSON.parse(localStorage.getItem('player_status_key'));
     if (player_status.skills[player_skill_command_select_skill_index].tp <= player_status.tp) {
      sound_clicksound();
      if (player_status.skills[player_skill_command_select_skill_index].all == true) {
       player_attack_command_select_enemy_index = 0;
       player_attack_command_selected();
      } else {
       player_attack_command();
      }
     } else {
      sound_clicknone();
     }
    }
    //こうげき
    function player_attack_command() {
     var enemy_status = JSON.parse(localStorage.getItem('enemy_status_key'));
     var player_status = JSON.parse(localStorage.getItem('player_status_key'));

     document.getElementById('player_battle_commands2').style.display = 'none';

     //敵が複数の時だけ動くやつ
     if (enemy_status.enemies.length > 1) {
      //敵の数だけボタンを生成
      document.getElementById('player_attack_enemy_select_2').innerHTML = "";
      for (index in enemy_status.enemies) {
       document.getElementById('player_attack_enemy_select_2').innerHTML += `<div style="height:40px;"><input type=\"submit\" value=\"${enemy_status.enemies[index].name}\"  id=\"testes-button\" class="btn btn-primary" style=\"opacity:100%;font-size:12px;height:30px;width:80%;\"onClick=\"sound_clicksound()\;player_attack_command_select_enemy_index = ${index}\;player_attack_command_selected()\;\"></div>`;
      }
      document.getElementById('player_attack_enemy_select').style.display = 'block';
     }
     //敵が一体だけの時即実行
     else {
      player_attack_command_select_enemy_index = 0;
      player_attack_command_selected();
     }
    }

    //選択後
    function player_attack_command_selected() {
     var enemy_status = JSON.parse(localStorage.getItem('enemy_status_key'));
     var player_status = JSON.parse(localStorage.getItem('player_status_key'));

     document.getElementById('player_attack_enemy_select').style.display = 'none';
     var enemy_index = player_attack_command_select_enemy_index * 1;
     var player_skill_index = player_skill_command_select_skill_index * 1;
     if (player_skill_index > -1 && player_status.skills[player_skill_index].all == true) enemy_index = 0;
     var enemy_number = enemy_status.enemies.length * 1 - 1;

     var target_all = false;
     if (player_skill_index > -1) {
      target_all = player_status.skills[player_skill_index].all;
      if (target_all == true) enemy_index = 0;
     }

     //わざかこうげきかの区別
     if (player_skill_index == -1) {
      player_status.tp = player_status.tp * 1 + 5;
      player_status.tp = player_status.tp * 1 > player_status.maxtp * 1 ? player_status.maxtp : player_status.tp;
      new_battlelog = `${player_status.name}のこうげき！`;
     } else {
      player_status.tp = player_status.tp * 1 - player_status.skills[player_skill_index].tp * 1;
      new_battlelog = `${player_status.name}の${player_status.skills[player_skill_index].name}！`;
     }

     setTimeout(() => {
      player_attack_command_selected_0();
     }, 500);

     function player_attack_command_selected_0() {
      var enemy_attack_interval = 600 - (enemy_status.enemies.length * 50);
      enemy_attack_interval = enemy_attack_interval < 10 ? 10 : enemy_attack_interval;

      var player_attack_interval = setInterval(() => {
       enemy_number = enemy_status.enemies.length * 1 - 1;

       var kaishin_random = Math.floor(Math.random() * 100) + 1;
       var kaishin_random_2 = 0;
       var kaishin_text = ``;
       var new_battlelog_yotei = ``;

       var player_attack_damage = 0;

       //わざかこうげきかの区別
       if (player_skill_index <= -1) {
        //つうじょうこうげき

        /*
        	target_all = true;
            enemy_index = 0;
         */
        player_attack_damage = Math.floor((player_status.atk * 1.5 - enemy_status.enemies[enemy_index].def * 1.2) + (Math.random() * 6));
        player_attack_damage = player_attack_damage < 1 ? 1 : player_attack_damage;

        if (kaishin_random <= 6) {
         kaishin_random_2 = 1;
         kaishin_text = `かいしんのいちげき！`;
         player_attack_damage = player_attack_damage * 3;
         sound_kaisinsound_1();
        }
        enemy_status.enemies[enemy_index].hp = (enemy_status.enemies[enemy_index].hp * 1) - player_attack_damage;
        enemy_status.enemies[enemy_index].hp = enemy_status.enemies[enemy_index].hp * 1 < 0 ? 0 : enemy_status.enemies[enemy_index].hp * 1;
        new_battlelog_yotei = `${kaishin_text}${enemy_status.enemies[enemy_index].name}は${player_attack_damage}ダメージうけた！`;

       } else {
        //わざ
        if (player_status.skills[player_skill_index].type == 'attack') {

         player_attack_damage = Math.floor((player_status.atk * 1.5 - enemy_status.enemies[enemy_index].def * 1.2) + (Math.random() * 6));
         player_attack_damage = player_attack_damage < 1 ? 1 : player_attack_damage;

         player_attack_damage = Math.floor(player_attack_damage * (player_status.skills[player_skill_index].atk * 1));


         if (kaishin_random <= 6) {
          kaishin_random_2 = 1;
          kaishin_text = `かいしんのいちげき！`;
          player_attack_damage = player_attack_damage * 3;
          sound_kaisinsound_1();
         }
         enemy_status.enemies[enemy_index].hp = (enemy_status.enemies[enemy_index].hp * 1) - player_attack_damage;
         enemy_status.enemies[enemy_index].hp = enemy_status.enemies[enemy_index].hp * 1 < 0 ? 0 : enemy_status.enemies[enemy_index].hp * 1;
         new_battlelog_yotei = `${kaishin_text}${enemy_status.enemies[enemy_index].name}は${player_attack_damage}ダメージうけた！`;
        }

       }

       var player_status_result = JSON.stringify(player_status);
       localStorage.setItem('player_status_key', player_status_result);


       new_battlelog = new_battlelog_yotei;
       if (player_skill_index == -1) {
        if (kaishin_random_2 == 1) {
         kaisinsound_1.stop();
         damagesound.play();
         sound_kaisinsound_2();
        } else {
         damagesound.play();
        }
       } else if (player_status.skills[player_skill_index].type == 'attack') {
        if (kaishin_random_2 == 1) {
         kaisinsound_1.stop();
         damagesound.play();
         sound_kaisinsound_2();
        } else {
         damagesound.play();
        }
       }
       var enemy_status_result = JSON.stringify(enemy_status);
       localStorage.setItem('enemy_status_key', enemy_status_result);
       if (enemy_status.enemies[enemy_index].hp <= 0) {
        var enemy_exp = localStorage.getItem('enemy_exp');
        if (!enemy_exp) enemy_exp = 0;
        enemy_exp = enemy_exp * 1 + enemy_status.enemies[enemy_index].exp * 1;
        localStorage.setItem('enemy_exp', enemy_exp);

        var enemy_coin = localStorage.getItem('enemy_coin');
        if (!enemy_coin) enemy_coin = 0;
        enemy_coin = enemy_coin * 1 + enemy_status.enemies[enemy_index].coin * 1;
        localStorage.setItem('enemy_coin', enemy_coin);

        new_battlelog += `<br>${player_status.name}は${enemy_status.enemies[enemy_index].name}をたおした！`;

        enemy_status.enemies[enemy_index].hp = 0;

        enemy_status.enemies.splice(enemy_index, 1);

        var enemy_status_result = JSON.stringify(enemy_status);
        localStorage.setItem('enemy_status_key', enemy_status_result);

        //ボス戦処理
        var boss_testfor = false;
        if (enemy_status.type == 'boss') {
         enemy_status.enemies.forEach((data, index) => {
          if (data.type == 'boss') boss_testfor = true;
         });
        }

        sound_deathsound();

        if (!enemy_status.enemies.length || (enemy_status.type == 'boss' && boss_testfor == false)) {
         if (enemy_status.enemies.length) {
          setTimeout(() => {
           var text = ``;
           for (index in enemy_status.enemies) {
            var escapelog = enemy_status.enemies[index].escapelog;
            if (escapelog == undefined) escapelog = "\`${enemy_status.enemies[index].name}はにげだした！\`";
            text += `<br>${eval(escapelog)}`
           }
           new_battlelog = text;
           enemy_status.enemies.splice(0, (enemy_status.enemies.length * 1));
           var enemy_status_result = JSON.stringify(enemy_status);
           localStorage.setItem('enemy_status_key', enemy_status_result);
           sound_escapesound();
           battle_end();
           levelup();
          }, 1800);
         } else {
          battle_end();
          levelup();
         }
         clearInterval(player_attack_interval);
         return;
        }
       } else {
        enemy_index += 1;
       }
       //  alert(`${enemy_index}\n${enemy_number}`);
       if (enemy_index > enemy_number || target_all == false) {

        /*
         	enemy_status.enemies.forEach((data,index)=>{
                 if(data.hp <= 0) enemy_status.enemies.splice(index,1);
            });
            */
        var enemy_status_result = JSON.stringify(enemy_status);
        localStorage.setItem('enemy_status_key', enemy_status_result);

        var total_maxhp_timeout = Math.floor(((total_maxhp * 1) / (total_hp * 1)) * 1000);
        setTimeout(() => {
         enemy_total_maxhp_set();
        }, total_maxhp_timeout);
        enemy_pattern();
        clearInterval(player_attack_interval);

       }

      }, enemy_attack_interval);

     }

    }


    let player_guard_value = 1.0;

    function player_guard_command() {
     var enemy_status = JSON.parse(localStorage.getItem('enemy_status_key'));
     var player_status = JSON.parse(localStorage.getItem('player_status_key'));

     player_guard_value = 0.5;
     new_battlelog = `${player_status.name}はぼうぎょした！`;
     sound_guardsound();

     player_status.tp = player_status.tp * 1 + 20;
     player_status.tp = player_status.tp * 1 > player_status.maxtp * 1 ? player_status.maxtp : player_status.tp;
     var player_status_result = JSON.stringify(player_status);
     localStorage.setItem('player_status_key', player_status_result);

     enemy_pattern();
    }

    function player_item_command() {
     var enemy_status = JSON.parse(localStorage.getItem('enemy_status_key'));
     var player_status = JSON.parse(localStorage.getItem('player_status_key'));

     document.getElementById('player_battle_commands2').style.display = 'none';
     //アイテムの数だけボタンを生成
     document.getElementById('player_attack_enemy_select_2').innerHTML = "";
     for (index in player_status.items) {
      document.getElementById('player_attack_enemy_select_2').innerHTML += `<div style="height:40px;"><input type=\"submit\" value=\"${player_status.items[index].name}  × ${player_status.items[index].number}"  id=\"item_select_button_${index}\" class="btn btn-primary" style=\"opacity:100%;font-size:10px;height:30px;width:86%;\"onClick=\"player_item_command_select_item_index = ${index}\;player_item_command_2()\;\"></div>`;
     }
     document.getElementById('player_attack_enemy_select').style.display = 'block';


     /*
   var command_result = window.confirm('100コイン消費して回復しますか？(現在即席システム)');
  if(command_result == true) {
  	if(player_status.coin >= 100){
   player_status.coin = player_status.coin * 1 - 100;
   var player_heal = Math.floor(player_status.maxhp * 0.5);
   player_status.hp = player_status.hp * 1 + player_heal * 1;
   player_status.hp = player_status.hp * 1 > player_status.maxhp * 1 ? player_status.maxhp:player_status.hp;

   new_battlelog = `${player_status.name}はアイテムをつかった！<br>${player_status.name}は${player_heal} 回復した！`;
   healsound.play(); 
      var player_status_result = JSON.stringify(player_status);
      localStorage.setItem('player_status_key', player_status_result);
   enemy_pattern();
   } else {
   	alert("コインが足りません( 'ω')");
   }
  }
 */
    }

    function player_item_command_2() {
     sound_clicksound();

     var enemy_status = JSON.parse(localStorage.getItem('enemy_status_key'));
     var player_status = JSON.parse(localStorage.getItem('player_status_key'));

     document.getElementById('player_attack_enemy_select').style.display = 'none';
     var enemy_index = player_attack_command_select_enemy_index * 1;
     var player_item_index = player_item_command_select_item_index * 1;
     if (player_item_index > -1 && player_status.items[player_item_index].type == 'attack' && player_status.items[player_item_index].all == true) enemy_index = 0;
     var enemy_number = enemy_status.enemies.length * 1 - 1;

     var target_all = false;
     target_all = player_status.items[player_item_index].all;
     if (target_all == true) enemy_index = 0;

     new_battlelog = `${player_status.name}は${player_status.items[player_item_index].name}をつかった！`;

     setTimeout(() => {
      player_item_command_selected_0();
     }, 500);

     function player_item_command_selected_0() {
      //	alert("a");


      if (player_status.items[player_item_index].type == 'heal') {
       var player_heal = Math.floor(player_status.items[player_item_index].value * 1);
       player_status.hp = player_status.hp * 1 + player_heal * 1;
       player_status.hp = player_status.hp * 1 > player_status.maxhp * 1 ? player_status.maxhp : player_status.hp;

       new_battlelog = `${player_status.name}は${player_heal} 回復した！`;
       healsound.play();

       if (player_status.items[player_item_index].cost == true) {
        if (player_status.items[player_item_index].number > 1) {
         var item_number = player_status.items[player_item_index].number * 1 - 1;
         player_status.items[player_item_index].number = item_number;
        } else {
         player_status.items.splice(player_item_index, 1);
        }
       }
       var player_status_result = JSON.stringify(player_status);
       localStorage.setItem('player_status_key', player_status_result);
       enemy_pattern();
      }
      else if (player_status.items[player_item_index].type == 'attack') {
       var enemy_attack_interval = 600 - (enemy_status.enemies.length * 50);
       enemy_attack_interval = enemy_attack_interval < 10 ? 10 : enemy_attack_interval;

       var player_attack_interval = setInterval(() => {
        enemy_number = enemy_status.enemies.length * 1 - 1;

        var kaishin_random = Math.floor(Math.random() * 100) + 1;
        var kaishin_random_2 = 0;
        var kaishin_text = ``;
        var new_battlelog_yotei = ``;

        var player_attack_damage = 0;


        player_attack_damage = Math.floor((player_status.atk * 1.5 - enemy_status.enemies[enemy_index].def * 1.2) + (Math.random() * 6));
        player_attack_damage = player_attack_damage < 1 ? 1 : player_attack_damage;


        if (kaishin_random <= 6) {
         kaishin_random_2 = 1;
         kaishin_text = `かいしんのいちげき！`;
         player_attack_damage = player_attack_damage * 3;
         sound_kaisinsound_1();
        }
        enemy_status.enemies[enemy_index].hp = (enemy_status.enemies[enemy_index].hp * 1) - player_attack_damage;
        enemy_status.enemies[enemy_index].hp = enemy_status.enemies[enemy_index].hp * 1 < 0 ? 0 : enemy_status.enemies[enemy_index].hp * 1;
        new_battlelog_yotei = `${kaishin_text}${enemy_status.enemies[enemy_index].name}は${player_attack_damage}ダメージうけた！`;


        if (player_status.items[player_item_index].cost == true) {
         if (player_status.items[player_item_index].number > 1) {
          var item_number = player_status.items[player_item_index].number * 1 - 1;
          player_status.items[player_item_index].number = item_number;
         } else {
          player_status.items.splice(player_item_index, 1);
         }
        }
        var player_status_result = JSON.stringify(player_status);
        localStorage.setItem('player_status_key', player_status_result);

        new_battlelog = new_battlelog_yotei;
        if (kaishin_random_2 == 1) {
         kaisinsound_1.stop();
         damagesound.play();
         sound_kaisinsound_2();
        } else {
         damagesound.play();
        }
        var enemy_status_result = JSON.stringify(enemy_status);
        localStorage.setItem('enemy_status_key', enemy_status_result);
        if (enemy_status.enemies[enemy_index].hp <= 0) {
         var enemy_exp = localStorage.getItem('enemy_exp');
         if (!enemy_exp) enemy_exp = 0;
         enemy_exp = enemy_exp * 1 + enemy_status.enemies[enemy_index].exp * 1;
         localStorage.setItem('enemy_exp', enemy_exp);

         var enemy_coin = localStorage.getItem('enemy_coin');
         if (!enemy_coin) enemy_coin = 0;
         enemy_coin = enemy_coin * 1 + enemy_status.enemies[enemy_index].coin * 1;
         localStorage.setItem('enemy_coin', enemy_coin);

         new_battlelog += `<br>${player_status.name}は${enemy_status.enemies[enemy_index].name}をたおした！`;

         enemy_status.enemies[enemy_index].hp = 0;

         enemy_status.enemies.splice(enemy_index, 1);

         var enemy_status_result = JSON.stringify(enemy_status);
         localStorage.setItem('enemy_status_key', enemy_status_result);

         //ボス戦処理
         var boss_testfor = false;
         if (enemy_status.type == 'boss') {
          enemy_status.enemies.forEach((data, index) => {
           if (data.type == 'boss') boss_testfor = true;
          });
         }

         sound_deathsound();

         if (!enemy_status.enemies.length || (enemy_status.type == 'boss' && boss_testfor == false)) {
          if (enemy_status.enemies.length) {
           setTimeout(() => {
            var text = ``;
            for (index in enemy_status.enemies) {
             var escapelog = enemy_status.enemies[index].escapelog;
             if (escapelog == undefined) escapelog = "\`${enemy_status.enemies[index].name}はにげだした！\`";
             text += `<br>${eval(escapelog)}`
            }
            new_battlelog = text;
            enemy_status.enemies.splice(0, (enemy_status.enemies.length * 1));
            var enemy_status_result = JSON.stringify(enemy_status);
            localStorage.setItem('enemy_status_key', enemy_status_result);
            sound_escapesound();
            battle_end();
            levelup();
           }, 1800);
          } else {
           battle_end();
           levelup();
          }
          clearInterval(player_attack_interval);
          return;
         }
        } else {
         enemy_index += 1;
        }
        if (enemy_index > enemy_number || target_all == false) {
         var enemy_status_result = JSON.stringify(enemy_status);
         localStorage.setItem('enemy_status_key', enemy_status_result);

         var total_maxhp_timeout = Math.floor(((total_maxhp * 1) / (total_hp * 1)) * 1000);
         setTimeout(() => {
          enemy_total_maxhp_set();
         }, total_maxhp_timeout);
         enemy_pattern();
         clearInterval(player_attack_interval);
        }
       }, enemy_attack_interval);
      }
     }
    }

    function player_holding_command() {
     var enemy_status = JSON.parse(localStorage.getItem('enemy_status_key'));
     var player_status = JSON.parse(localStorage.getItem('player_status_key'));

     new_battlelog = `${player_status.name}はなにもしなかった！`;

     enemy_pattern();

    }

    function player_escape_command() {
     var enemy_status = JSON.parse(localStorage.getItem('enemy_status_key'));
     var player_status = JSON.parse(localStorage.getItem('player_status_key'));
     new_battlelog = `${player_status.name}はバトルからにげた！`;
     sound_escapesound();
     battle_end();
    }

    //敵の行動パターン
    function enemy_pattern() {
     var enemy_index = 0;
     document.getElementById("player_battle_commands2").style.display = "none";
     var enemy_status = JSON.parse(localStorage.getItem('enemy_status_key'));
     var player_status = JSON.parse(localStorage.getItem('player_status_key'));

     var enemy_number = enemy_status.enemies.length * 1 - 1;

     setTimeout(() => {
      enemy_pattern_0();
      // document.getElementById('testsound').play();
     }, 1000);

     function enemy_pattern_0() {
      var enemy_attack_interval = 1100 - (enemy_status.enemies.length * 100);
      enemy_attack_interval = enemy_attack_interval < 10 ? 10 : enemy_attack_interval;
      //パターンてすてす
      if (enemy_status.enemies[enemy_index].id == 'enm_testes') {
       var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 1.5 - player_status.def * 1.2) + (Math.random() * 5)) * player_guard_value);
       enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
       player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
       new_battlelog = `${enemy_status.enemies[enemy_index].name}のこうげき！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
       damagesound.play();
      }
      //パターンてすてすキング
      else if (enemy_status.enemies[enemy_index].id == 'enm_testes_king') {
       var enemy_randomize = Math.floor(Math.random() * 1000);
       if (enemy_randomize - 300 <= 0 && enemy_status.enemies.length <= 4) {
        var summon_randomize = Math.floor(Math.random() * 2);

        var enemy_data = ``;
        if (summon_randomize == 0) {
         enemy_data = JSON.stringify({
          id: "enm_testes",
          name: `エリートてすてす ${(enemy_status.enemies.length * 1)}`,
          hp: 90,
          maxhp: 90,
          atk: 20,
          def: 10,
          exp: 100,
          coin: 100,
          escapelog: "\`${enemy_status.enemies[index].name}はにげだした！\`"
         });
        }
        else if (summon_randomize == 1) {
         enemy_data = JSON.stringify({
          id: "enm_testes_dr",
          name: `ドクターてすてす ${(enemy_status.enemies.length * 1)}`,
          hp: 100,
          maxhp: 100,
          atk: 10,
          def: 18,
          exp: 100,
          coin: 100,
          escapelog: "\`${enemy_status.enemies[index].name}はにげだした！\`"
         });
        }
        enemy_status.enemies.push(JSON.parse(enemy_data));
        var enemy_status_result = JSON.stringify(enemy_status);
        localStorage.setItem('enemy_status_key', enemy_status_result);
        enemy_total_maxhp_set();
        new_battlelog = `${enemy_status.enemies[enemy_index].name}はみかたをよんだ！`;
        sound_shoukansound();
       }
       else {
        var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 1.5 - player_status.def * 1.2) + (Math.random() * 5)) * player_guard_value);
        enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
        player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}のこうげき！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
        damagesound.play();
       }
      }
      //パターンドクターてすてす
      else if (enemy_status.enemies[enemy_index].id == 'enm_testes_dr') {
       var enemy_randomize = Math.floor(Math.random() * 1000);
       if (enemy_randomize - 500 <= 0 && total_hp <= total_maxhp) {
        var heal_randomize = Math.floor(Math.random() * enemy_status.enemies.length);
        var enemy_heal = 60;
        enemy_status.enemies[heal_randomize].hp = enemy_status.enemies[heal_randomize].hp * 1 + enemy_heal;
        enemy_status.enemies[heal_randomize].hp = enemy_status.enemies[heal_randomize].maxhp < enemy_status.enemies[heal_randomize].hp ? enemy_status.enemies[heal_randomize].maxhp : enemy_status.enemies[heal_randomize].hp;
        enemy_total_maxhp_set();
        var new_battlelog_yotei = `${enemy_status.enemies[enemy_index].name}は${enemy_status.enemies[heal_randomize].name}に回復薬を投げた！<br>${enemy_status.enemies[heal_randomize].name}は${enemy_heal}回復した！`;
        new_battlelog_yotei = heal_randomize == enemy_index ? `${enemy_status.enemies[enemy_index].name}は回復薬を飲んだ！${enemy_heal}回復した！` : new_battlelog_yotei;
        new_battlelog = new_battlelog_yotei;
        healsound.play();
       }
       else {
        var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 1.5 - player_status.def * 1.2) + (Math.random() * 5)) * player_guard_value);
        enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
        player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}のこうげき！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
        damagesound.play();
       }
      }

      //パターンつよいがいこつ
      else if (enemy_status.enemies[enemy_index].id == 'enm_strong_skeleton') {
       var enemy_randomize = Math.floor(Math.random() * 1000);
       if (enemy_randomize - 300 <= 0) {
        var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 2.2 - player_status.def * 1.2) + (Math.random() * 5)) * player_guard_value);
        enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
        player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}のきっく！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
        damagesound.play();
       }
       else {
        var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 1.5 - player_status.def * 1.2) + (Math.random() * 5)) * player_guard_value);
        enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
        player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}のこうげき！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
        damagesound.play();
       }
      }
      //パターンメタルなんとか
      else if (enemy_status.enemies[enemy_index].id == 'enm_metal_nan') {
       var enemy_randomize = Math.floor(Math.random() * 1000);
       if (enemy_randomize - 300 <= 0) {
        var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 2.8 - player_status.def * 1.2) + (Math.random() * 5)) * player_guard_value);
        enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
        player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}のこんしんのたいあたり！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
        damagesound.play();
       }
       else {
        var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 1.5 - player_status.def * 1.2) + (Math.random() * 5)) * player_guard_value);
        enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
        player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}のこうげき！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
        damagesound.play();
       }
      }
      //パターンメタルなんとかEX
      else if (enemy_status.enemies[enemy_index].id == 'enm_metal_nan_ex') {
       var enemy_randomize = Math.floor(Math.random() * 1000);
       if (enemy_randomize - 100 <= 0) {
        var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 4.5 - player_status.def * 1.2) + (Math.random() * 5)) * player_guard_value);
        enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
        player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}のひっさつ  ずつき！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
        damagesound.play();
       }
       if (enemy_randomize - 300 <= 0) {
        var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 2.8 - player_status.def * 1.2) + (Math.random() * 5)) * player_guard_value);
        enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
        player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}のこんしんのたいあたり！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
        damagesound.play();
       }
       else {
        var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 1.5 - player_status.def * 1.2) + (Math.random() * 5)) * player_guard_value);
        enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
        player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}のこうげき！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
        damagesound.play();
       }
      }
      //パターンあああ
      else if (enemy_status.enemies[enemy_index].id == 'enm_aaa') {
       var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 1.5 - player_status.def * 1.2) + (Math.random() * 5)) * player_guard_value);
       enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
       player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
       new_battlelog = `${enemy_status.enemies[enemy_index].name}のこうげき！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
       damagesound.play();
      }
      //パターンクリル
      else if (enemy_status.enemies[enemy_index].id == 'enm_cril') {
       if (enemy_status.enemies[enemy_index].cril_act_event_1 == 1) {
        enemy_status.enemies[enemy_index].cril_act_event_1 = 0;
       }
       else if (enemy_status.enemies[enemy_index].cril_act_event_1 == 0) {
        enemy_status.enemies[enemy_index].cril_act_event_1 = 1;
       }
       else if (enemy_status.enemies[enemy_index].cril_act_event_1 == undefined) {
        enemy_status.enemies[enemy_index].cril_act_event_1 = 0;
       }

       var enemy_randomize = Math.floor(Math.random() * 1000);
       if (enemy_status.enemies[enemy_index].hp < 5000 && enemy_status.enemies[enemy_index].cril_hp_event_0 != true) {
        enemy_status.enemies[enemy_index].cril_hp_event_0 = true;
        enemy_status.enemies[enemy_index].hp = enemy_status.enemies[enemy_index].maxhp;
        enemy_status.enemies[enemy_index].atk = Math.floor(enemy_status.enemies[enemy_index].atk * 1.5);
        enemy_status.enemies[enemy_index].def = Math.floor(enemy_status.enemies[enemy_index].def * 1.5);
        enemy_total_maxhp_set();
        new_battlelog = `${enemy_status.enemies[enemy_index].name}はいらだっている！<br>${enemy_status.enemies[enemy_index].name}は超回復薬をつかった！99999回復した！<br>ステータスが上がった！`;
        healsound.play();
        sound_shoukansound();
       }
       else if (enemy_status.enemies[enemy_index].cril_hp_event_1 == 1) {
        enemy_status.enemies[enemy_index].cril_hp_event_1 = undefined;
        enemy_status.enemies[enemy_index].hp = enemy_status.enemies[enemy_index].maxhp;
        var enemy_attack_damage = (player_status.maxhp * 1) - 1;
        enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
        player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}「神滅槍 ファイナルクラルスピア！」<br>${enemy_status.enemies[enemy_index].name}は99999回復した！${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
        sound_shoukansound();
        sound_skillsound();
        damagesound.play();
       }
       else if (enemy_status.enemies[enemy_index].cril_hp_event_1 == 2) {
        enemy_status.enemies[enemy_index].cril_hp_event_1 = 1;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}はなにか準備している！<br>{あと 1 ターン}`;
        sound_shoukansound();
       }
       else if (enemy_status.enemies[enemy_index].cril_hp_event_1 == 3) {
        enemy_status.enemies[enemy_index].cril_hp_event_1 = 2;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}はなにか準備している！<br>{あと 2 ターン}`;
        sound_shoukansound();
       }
       else if (enemy_status.enemies[enemy_index].hp < 1500 && enemy_status.enemies[enemy_index].cril_hp_event_1 == undefined) {
        enemy_status.enemies[enemy_index].cril_hp_event_1 = 3;
        enemy_status.enemies[enemy_index].def = Math.floor(enemy_status.enemies[enemy_index].def * 1.2);
        new_battlelog = `${enemy_status.enemies[enemy_index].name}はなにか準備している！<br>{あと 3 ターン}`;
        sound_shoukansound();
       }
       else if (enemy_randomize - 70 <= 0) {
        var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 4.0 - player_status.def * 1.2) + (Math.random() * 5)) * player_guard_value);
        enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
        player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}の神葬 クラルスクリア！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
        damagesound.play();
       }
       else if (enemy_randomize - 100 <= 0 && total_hp <= total_maxhp) {
        var heal_randomize = Math.floor(Math.random() * enemy_status.enemies.length);
        var enemy_heal = Math.floor(enemy_status.enemies[enemy_index].maxhp * 0.1);
        enemy_status.enemies[heal_randomize].hp = enemy_status.enemies[heal_randomize].hp * 1 + enemy_heal;
        enemy_status.enemies[heal_randomize].hp = enemy_status.enemies[heal_randomize].maxhp < enemy_status.enemies[heal_randomize].hp ? enemy_status.enemies[heal_randomize].maxhp : enemy_status.enemies[heal_randomize].hp;
        enemy_total_maxhp_set();
        var new_battlelog_yotei = `${enemy_status.enemies[enemy_index].name}は${enemy_status.enemies[heal_randomize].name}に回復薬を投げた！<br>${enemy_status.enemies[heal_randomize].name}は${enemy_heal}回復した！`;
        new_battlelog_yotei = heal_randomize == enemy_index ? `${enemy_status.enemies[enemy_index].name}は回復薬を飲んだ！${enemy_heal}回復した！` : new_battlelog_yotei;
        new_battlelog = new_battlelog_yotei;
        healsound.play();
       }
       else if (enemy_randomize - 200 <= 0) {
        var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 1.2) + (Math.random() * 5)) * player_guard_value);
        enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
        player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}はデリートジエンドを放った！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
        damagesound.play();
       }
       else {
        var enemy_attack_damage = Math.floor(((enemy_status.enemies[enemy_index].atk * 1.5 - player_status.def * 1.2) + (Math.random() * 5)) * player_guard_value);
        enemy_attack_damage = enemy_attack_damage < 1 ? 1 : enemy_attack_damage;
        player_status.hp = (player_status.hp * 1) - enemy_attack_damage;
        new_battlelog = `${enemy_status.enemies[enemy_index].name}のこうげき！<br>${player_status.name}は${enemy_attack_damage}ダメージうけた！`;
        damagesound.play();
       }
      }

      else {
       new_battlelog = `${enemy_status.enemies[enemy_index].name}はなにもしなかった！`;
      }

      player_status.hp = player_status.hp * 1 < 0 ? 0 : player_status.hp * 1;
      player_guard_value = 1.0;
      var player_status_result = JSON.stringify(player_status);
      localStorage.setItem('player_status_key', player_status_result);
      var enemy_status_result = JSON.stringify(enemy_status);
      localStorage.setItem('enemy_status_key', enemy_status_result);

      if (player_status.hp <= 0) {
       new_battlelog = `${player_status.name}はちからつきてしまった...`;
       battle_end();
       return;
      }
      rpg_player_status_set();

      enemy_index += 1;
      if (enemy_number >= enemy_index) {
       setTimeout(enemy_pattern_0, enemy_attack_interval);
      } else {
       setTimeout(() => {
        document.getElementById("player_battle_commands2").style.display = "block";
       }, 700);
      }
     }
    }

    //てすてす1
    function enemy_testes() {
     var enemy_status = JSON.parse('{"enemies":[]}');
     var enemy_data = JSON.stringify({
      id: "enm_testes",
      name: "てすてす",
      hp: 20,
      maxhp: 20,
      atk: 1,
      def: 0,
      exp: 10,
      coin: 100
     });
     enemy_status.enemies.push(JSON.parse(enemy_data));
     enemy_status = JSON.stringify(enemy_status);
     localStorage.setItem('enemy_status_key', enemy_status);
     battle_start();
    }

    //てすてす2
    function enemy_testes_2() {
     var enemy_status = JSON.parse('{"enemies":[]}');

     var enemy_data = JSON.stringify({
      id: "enm_testes",
      name: "てすてす 1",
      hp: 30,
      maxhp: 30,
      atk: 2,
      def: 0,
      exp: 10,
      coin: 100
     });
     enemy_status.enemies.push(JSON.parse(enemy_data));
     var enemy_data = JSON.stringify({
      id: "enm_testes",
      name: "てすてす 2",
      hp: 45,
      maxhp: 45,
      atk: 2,
      def: 0,
      exp: 15,
      coin: 100
     });
     enemy_status.enemies.push(JSON.parse(enemy_data));
     var enemy_data = JSON.stringify({
      id: "enm_testes",
      name: "てすてす 3",
      hp: 20,
      maxhp: 20,
      atk: 10,
      def: 15,
      exp: 10,
      coin: 100
     });
     enemy_status.enemies.push(JSON.parse(enemy_data));

     enemy_status = JSON.stringify(enemy_status);
     localStorage.setItem('enemy_status_key', enemy_status);
     battle_start();
    }
    //てすてす3
    function enemy_testes_3() {
     var enemy_status = JSON.parse('{"type": "boss", "enemies":[]}');

     var enemy_data = JSON.stringify({
      type: "boss",
      id: "enm_testes_king",
      name: "てすてすキング",
      hp: 300,
      maxhp: 300,
      atk: 25,
      def: 25,
      exp: 1000,
      coin: 1000
     });
     enemy_status.enemies.push(JSON.parse(enemy_data));
     var enemy_data = JSON.stringify({
      id: "enm_testes",
      name: "エリートてすてす 1",
      hp: 150,
      maxhp: 150,
      atk: 15,
      def: 30,
      exp: 200,
      coin: 300,
      escapelog: "\`${enemy_status.enemies[index].name}はにげだした！\`"
     });
     enemy_status.enemies.push(JSON.parse(enemy_data));
     var enemy_data = JSON.stringify({
      id: "enm_testes",
      name: "エリートてすてす 2",
      hp: 90,
      maxhp: 90,
      atk: 26,
      def: 10,
      exp: 300,
      coin: 200,
      escapelog: "\`${enemy_status.enemies[index].name}はにげだした！\`"
     });
     enemy_status.enemies.push(JSON.parse(enemy_data));

     enemy_status = JSON.stringify(enemy_status);
     localStorage.setItem('enemy_status_key', enemy_status);
     battle_start();
    }

    //メタルなんとか
    function enemy_metal_nan_0() {
     var enemy_status = JSON.parse('{"enemies":[]}');

     for (let i = 1; i <= 4; i++) {
      var enemy_data = JSON.stringify({
       id: "enm_metal_nan",
       name: `メタルなんとか ${i}`,
       hp: 8,
       maxhp: 8,
       atk: 10,
       def: "Infinity",
       exp: 999,
       coin: 500
      });
      enemy_status.enemies.push(JSON.parse(enemy_data));
     }
     var enemy_data = JSON.stringify({
      id: "enm_metal_nan_ex",
      name: "メタルなんとかEX",
      hp: 30,
      maxhp: 30,
      atk: 35,
      def: "Infinity",
      exp: 9999,
      coin: 999
     });
     enemy_status.enemies.push(JSON.parse(enemy_data));

     enemy_status = JSON.stringify(enemy_status);
     localStorage.setItem('enemy_status_key', enemy_status);
     battle_start();
    }

    //メタルなんとかEX
    function enemy_metal_nan_1() {
     var enemy_status = JSON.parse('{"type": "boss", "enemies":[]}');

     for (let i = 1; i <= 1; i++) {
      var enemy_data = JSON.stringify({
       id: "enm_metal_nan_ex",
       name: `メタルなんとかEX ${i}`,
       hp: 30,
       maxhp: 30,
       atk: 35,
       def: "Infinity",
       exp: 9999,
       coin: 999
      });
      enemy_status.enemies.push(JSON.parse(enemy_data));
     }
     var enemy_data = JSON.stringify({
      type: "boss",
      id: "enm_metal_nan_ex",
      name: "メタルシン",
      hp: 50,
      maxhp: 50,
      atk: 45,
      def: "Infinity",
      exp: 12000,
      coin: 1200
     });
     enemy_status.enemies.push(JSON.parse(enemy_data));

     enemy_status = JSON.stringify(enemy_status);
     localStorage.setItem('enemy_status_key', enemy_status);
     battle_start();
    }

    //クリルクラルサー
    function enemy_cril() {
     var enemy_status = JSON.parse('{"type": "boss", "enemies":[]}');

     var enemy_data = JSON.stringify({
      type: "boss",
      id: "enm_cril",
      name: "クリル・クラルサー",
      hp: 9900,
      maxhp: 9900,
      atk: 120,
      def: 50,
      exp: 99999,
      coin: 10000
     });
     enemy_status.enemies.push(JSON.parse(enemy_data));

     enemy_status = JSON.stringify(enemy_status);
     localStorage.setItem('enemy_status_key', enemy_status);
     battle_start();
    }
    //テスト
    function enemy_cril_2() {
     var enemy_status = JSON.parse('{"enemies":[]}');

     for (let i = 1; i <= 5; i++) {
      var enemy_data = JSON.stringify({
       id: "enm_cril",
       name: `クリル・クラルサー ${i}`,
       hp: 9900,
       maxhp: 9900,
       atk: 120,
       def: 50,
       exp: 99999,
       coin: 10000
      });
      enemy_status.enemies.push(JSON.parse(enemy_data));
     }

     enemy_status = JSON.stringify(enemy_status);
     localStorage.setItem('enemy_status_key', enemy_status);
     battle_start();
    }

    //テスト
    function enemy_metal_mini() {
     var enemy_status = JSON.parse('{"enemies":[]}');

     for (let i = 1; i <= 100; i++) {
      var enemy_data = JSON.stringify({
       id: "enm_metal_nan",
       name: `メタルみに ${i}`,
       hp: 10,
       maxhp: 10,
       atk: 30,
       def: "Infinity",
       exp: 10,
       coin: 10
      });
      enemy_status.enemies.push(JSON.parse(enemy_data));
     }

     enemy_status = JSON.stringify(enemy_status);
     localStorage.setItem('enemy_status_key', enemy_status);
     battle_start();
    }


    //テスト

    function test_enemy_death1() {
     localStorage.setItem('enemy_exp', 10);
     levelup();
    }

    function test_enemy_death2() {
     localStorage.setItem('enemy_exp', 100);
     levelup();
    }

    function test_enemy_death3() {
     localStorage.setItem('enemy_exp', 1000);
     levelup();
    }

    function test_enemy_death4() {
     localStorage.setItem('enemy_exp', 9999);
     levelup();
    }

    function test_enemy_death5() {
     localStorage.setItem('enemy_exp', Infinity);
     levelup();
    }

    rpg_player_status_set();
   </script>
   <div id="rpg_game_blocker" style="z-index: 900;position:fixed;width:120%;height:120%;">
    <img style="position:fixed;top:0px;left:0px;z-index: 599;width:110%;height:110%;" class="img-responsive center-block" src="https://cdn.discordapp.com/attachments/706660445519347763/708266741398241310/333-2.png">
    <h2 style="z-index: 901;position:fixed;color:while;" align="center">このゲームは画面横向き専用です。</h2>
   </div>
  </rpg>
 </div>
 <!-- ページ操作 -->
 <script>
  let psmb_anim = true;

  function player_status_main_button() {
   let status_display = document.getElementById("player_status_main");

   function player_status_in_anim() {
    psmb_anim = false;
    var psmb_in_anim = -300;
    status_display.style.right = `${psmb_in_anim}px`;
    status_display.style.display = "block";
    var psmb_in_anim_interval = setInterval(() => {
     status_display.style.right = `${psmb_in_anim}px`;
     psmb_in_anim += 20;
     if (psmb_in_anim >= 0) {
      status_display.style.right = `0px`;
      psmb_anim = true;
      clearInterval(psmb_in_anim_interval);
     }
    }, 20);
    return;
   }

   function player_status_out_anim() {
    psmb_anim = false;
    var psmb_out_anim = 0;
    status_display.style.right = `${psmb_out_anim}px`;
    var psmb_out_anim_interval = setInterval(() => {
     status_display.style.right = `${psmb_out_anim}px`;
     psmb_out_anim -= 20;
     if (psmb_out_anim <= -300) {
      status_display.style.right = `-300px`;
      status_display.style.display = "none";
      psmb_anim = true;
      clearInterval(psmb_out_anim_interval);
     }
    }, 20);
    return;
   }
   if (psmb_anim == true && status_display.style.display == "none") player_status_in_anim();
   if (psmb_anim == true && status_display.style.display == "block") player_status_out_anim();
  }

  function reset() {
   document.getElementById("home").style.display = "none";
   document.getElementById("slot-game").style.display = "none";
   document.getElementById("rpg-game").style.display = "none";
  }
  reset();

  document.getElementById("player_status_main").style.display = "none";
  rpg_player_status_set();

  function rpg_move_button() {
   reset();
   rpg_player_status_set();
   document.getElementById("rpg-game").style.display = "block";
  }

  function slot_move_button() {
   reset();
   var player_status = JSON.parse(localStorage.getItem('player_status_key'));
   if (player_status) document.getElementById("slot-shojikin").innerHTML = `しょじきん: ${player_status.coin} ｺｲﾝ`;
   document.getElementById("slot-game").style.display = "block";
  }

  function home_move_button() {
   reset();
   document.getElementById("home").style.display = "block";
  }
 </script>
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</body>

</html>